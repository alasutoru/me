<header class="page-header">
    <div class="myname"> 
        <h2><a href="{{ default .Site.Home .Site.BaseURL }}">{{ default .Site.Params.Author .Site.Params.siteHeading }}</a></h2> 
    </div>
    <nav>
        <ul class="navbar">
        {{- /* info about current page */ -}}
            {{- $currentPage := . -}}
            {{- $currentPagesParent := $currentPage.Parent -}}
            {{- $currentPageInTags := eq $currentPage.Section "tags" -}}
            {{- $currentPageInCategories := eq $currentPage.Section "categories" -}}
            {{- $currentPageNotHome := ne $currentPage.IsHome true -}}

        {{- range .Site.Menus.main -}}
            {{- if .HasChildren -}}

            {{- /* info about current menu */ -}}
                {{- $currentMenusPage := .Page -}}

                {{- $currentMenuHasTags := false -}}
                {{- $currentMenuHasCategories := false -}}
                {{- range .Children -}}
                    {{- $childMenuSection := .Page.Section -}}
                    {{- if eq $childMenuSection "categories" -}}{{- $currentMenuHasCategories = true -}}{{- end -}}
                    {{- if eq $childMenuSection "tags" -}}{{- $currentMenuHasTags = true -}}{{- end -}}
                {{- end -}}

            {{- /* comparison of current menu and current page */ -}}
                {{- $active := eq $currentMenusPage $currentPagesParent -}}
                {{- $active = and $active $currentPageNotHome -}}
                {{- $active = or $active (and $currentMenuHasTags $currentPageInTags) -}}
                {{- $active = or $active (and $currentMenuHasCategories $currentPageInCategories) }}
            <li class="dropdown {{ if or $active ($currentPage.IsMenuCurrent "main" . ) ($currentPage.HasMenuCurrent "main" .)}}activetab{{ end }}">
                <a href ="{{ .URL }}">
                    {{- .Pre }}
                    <span>{{ .Name }}</span>
                </a>
                <div class=sub-menu>
                {{- range .Children }}
                    {{- $currentMenuSection := .Page.Section }}
                    {{- $active := and $currentPageInTags (eq $currentMenuSection "tags") }}
                    {{- $active = or $active (and $currentPageInCategories (eq $currentMenuSection "categories") ) }}
                    {{- $active = or $active ($currentPage.IsMenuCurrent "main" . ) }}
                    <a class="{{- if $active -}}activetab{{- end -}}" href="{{- .URL -}}">{{ .Name }}</a>
                {{- end }}
                </div>
            </li>
            {{- else -}}
                {{- /* This is the corrected block for simple menu items. */ -}}
                {{- /* It uses Hugo's reliable functions to check for active state. */ -}}
                {{- /* This bypasses the buggy logic from the original theme that caused empty href attributes. */ -}}
            <li class="{{ if $currentPage.IsMenuCurrent "main" . }}activetab{{ end }}">
                <a href="{{ .URL }}">
                    {{- .Pre }}
                    <span>{{ .Name }}</span>
                </a>
            </li>
            {{- end }}
        {{- end }}
        </ul>
    </nav>
</header>